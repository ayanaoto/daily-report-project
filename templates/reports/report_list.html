{% extends "base.html" %}
{% load static %}

{% block title %}ãƒ¬ãƒãƒ¼ãƒˆä¸€è¦§{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <h1 class="mb-4 fw-bold">ãƒ¬ãƒãƒ¼ãƒˆä¸€è¦§</h1>

  <!-- æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
  <form method="get" class="row g-3 align-items-end mb-3">
    <div class="col-12 col-sm-6 col-md-3">
      <label class="form-label">é–‹å§‹æ—¥</label>
      <input type="date" name="start" value="{{ request.GET.start }}" class="form-control fn-input" placeholder="å¹´ / æœˆ / æ—¥">
    </div>

    <div class="col-12 col-sm-6 col-md-3">
      <label class="form-label">çµ‚äº†æ—¥</label>
      <input type="date" name="end" value="{{ request.GET.end }}" class="form-control fn-input" placeholder="å¹´ / æœˆ / æ—¥">
    </div>

    <div class="col-12 col-md-4">
      <label class="form-label">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
      <input type="text" name="q" value="{{ request.GET.q }}" class="form-control fn-input" placeholder="é¡§å®¢ãƒ»ä»¶åãƒ»æœ¬æ–‡ãªã©">
    </div>

    <div class="col-6 col-md-2">
      <label class="form-label">ä¸¦ã³</label>
      <select name="sort" class="form-select fn-select">
        <option value="-created" {% if request.GET.sort == "-created" or not request.GET.sort %}selected{% endif %}>æ–°ã—ã„é †</option>
        <option value="created"  {% if request.GET.sort == "created" %}selected{% endif %}>å¤ã„é †</option>
        <option value="-id"      {% if request.GET.sort == "-id" %}selected{% endif %}>IDé™é †</option>
        <option value="id"       {% if request.GET.sort == "id" %}selected{% endif %}>IDæ˜‡é †</option>
        <option value="author"   {% if request.GET.sort == "author" %}selected{% endif %}>æ‹…å½“è€…Aâ†’Z</option>
        <option value="-author"  {% if request.GET.sort == "-author" %}selected{% endif %}>æ‹…å½“è€…Zâ†’A</option>
      </select>
    </div>

    <div class="col-6 col-md-2">
      <label class="form-label">ä»¶æ•°/é </label>
      <select name="per_page" class="form-select fn-select">
        <option value="10" {% if request.GET.per_page == "10" or not request.GET.per_page %}selected{% endif %}>10</option>
        <option value="20" {% if request.GET.per_page == "20" %}selected{% endif %}>20</option>
        <option value="50" {% if request.GET.per_page == "50" %}selected{% endif %}>50</option>
        <option value="100" {% if request.GET.per_page == "100" %}selected{% endif %}>100</option>
      </select>
    </div>

    <div class="col-12 d-flex fn-actions flex-wrap">
      <button class="btn btn-primary">çµã‚Šè¾¼ã¿</button>
      <a class="btn btn-outline-secondary" href="{% url 'reports:report_list' %}">ãƒªã‚»ãƒƒãƒˆ</a>
      <a class="btn btn-outline-info" href="{% url 'reports:report_export_csv' %}?{{ request.GET.urlencode }}">CSV</a>
      <a class="btn btn-success ms-auto" href="{% url 'reports:report_create' %}">ï¼‹ æ–°è¦ä½œæˆ</a>
      <a class="btn btn-outline-dark ms-2" href="{% url 'reports:dashboard' %}">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸</a>
    </div>
  </form>

  {% if reports %}
    <div class="table-responsive">
      <table class="table table-dark table-striped align-middle">
        <thead>
          <tr>
            <th style="width: 6rem;">ID</th>
            <th style="width: 14rem;">ä½œæˆæ—¥æ™‚</th>
            <th>ã‚¿ã‚¤ãƒˆãƒ« / æœ¬æ–‡</th>
            <th style="width: 10rem;">æ‹…å½“è€…</th>
            <th style="width: 8rem;"></th>
          </tr>
        </thead>
        <tbody>
          {% for r in reports %}
            <tr>
              <td>#{{ r.id }}</td>
              <td>
                {% if r.created_at %}{{ r.created_at|date:"Y-m-d H:i" }}
                {% elif r.date %}{{ r.date|date:"Y-m-d" }}
                {% elif r.report_date %}{{ r.report_date|date:"Y-m-d" }}
                {% else %}-{% endif %}
              </td>
              <td>
                <div class="fw-semibold">
                  {% if r.title %}{{ r.title }}{% else %}(ç„¡é¡Œ){% endif %}
                  {% if r.location %}<span class="text-secondary ms-2">â€” {{ r.location }}</span>{% endif %}
                </div>
                {% if r.content %}
                  <div class="text-secondary small text-truncate" style="max-width: 70ch;">
                    {{ r.content|striptags }}
                  </div>
                {% endif %}
              </td>
              <td>
                {% if r.author %}{{ r.author }}{% else %}-{% endif %}
              </td>
              <td class="text-end">
                <a class="btn btn-sm btn-outline-light" href="{% url 'reports:report_detail' r.pk %}">è©³ç´°</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if is_paginated %}
      <nav class="mt-3" aria-label="Page navigation">
        <ul class="pagination">
          {% if page_obj.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}&{{ request.GET.urlencode }}">Â«</a></li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">Â«</span></li>
          {% endif %}

          <li class="page-item disabled">
            <span class="page-link">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
          </li>

          {% if page_obj.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}&{{ request.GET.urlencode }}">Â»</a></li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">Â»</span></li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  {% else %}
    <div class="alert alert-info">è©²å½“ã™ã‚‹ãƒ¬ãƒãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>
  {% endif %}
</div>
{% endblock %}
