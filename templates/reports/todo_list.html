{# templates/reports/todo_list.html #}
{% extends "base.html" %}
{% load static %}
{% block title %}必要物品（ToDo・2列）{% endblock %}

{% block content %}
<div class="card shadow-soft">
  <div class="card-header">必要物品リスト</div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-striped mb-0" id="todoTable">
        <thead>
          <tr>
            <th style="width: 180px;">投稿日</th>
            <th>必要なもの</th>
          </tr>
        </thead>
        <tbody>
          {% if todos %}
            {% for t in todos %}
              <tr>
                <td class="text-nowrap">
                  {% if t.created_at %}
                    {{ t.created_at|date:"Y-m-d H:i" }}
                  {% elif t.updated_at %}
                    {{ t.updated_at|date:"Y-m-d H:i" }}
                  {% else %}
                    -
                  {% endif %}
                </td>
                <td>
                  <strong>
                    {# 品目名（存在する候補からフォールバック） #}
                    {% if t.name %}{{ t.name }}
                    {% elif t.title %}{{ t.title }}
                    {% elif t.subject %}{{ t.subject }}
                    {% else %}(名称未設定){% endif %}
                  </strong>
                  {# 数量・単位（存在時のみ） #}
                  {% if t.quantity %} × {{ t.quantity|floatformat:-2 }}{% endif %}
                  {% if t.unit %} {{ t.unit }}{% endif %}

                  {# 補足（任意：メモ/備考/説明） #}
                  {% if t.memo or t.note or t.remarks or t.description %}
                    <div class="text-muted small mt-1">
                      {{ t.memo|default:t.note|default:t.remarks|default:t.description }}
                    </div>
                  {% endif %}

                  {# 元レポートへリンク（存在する場合のみ。URL名は環境に合わせて） #}
                  {% if t.source_report_id or t.report_id %}
                    <div class="mt-1">
                      {# reports:report_detail がある場合だけ有効化 #}
                      {# <a class="small" href="{% url 'reports:report_detail' t.source_report_id|default:t.report_id %}">
                           出典: 日報 #{{ t.source_report_id|default:t.report_id }}
                         </a> #}
                      <span class="small text-muted">出典: 日報 #{{ t.source_report_id|default:t.report_id }}</span>
                    </div>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="2" class="text-center">
                該当するレコードはありません。
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
