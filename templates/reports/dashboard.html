{% extends "base.html" %}

{% block title %}ダッシュボード{% endblock %}

{% block page_title %}ダッシュボード{% endblock %}

{% block content %}
<div class="row g-4">
  <div class="col-lg-6">
    <div class="card">
      <div class="card-header">
        ユーザー別のレポート件数
      </div>
      <div class="card-body">
        <canvas id="userReportChart"></canvas>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card">
      <div class="card-header">
        あなたの進捗状況
      </div>
      <div class="card-body">
        <canvas id="progressChart"></canvas>
      </div>
    </div>
  </div>

  <div class="col-12">
    <div class="card">
      <div class="card-header">
        場所ごとの合計作業時間
      </div>
      <div class="card-body">
        <canvas id="hoursChart"></canvas>
      </div>
    </div>
  </div>
</div>

{# Chart.jsライブラリの読み込み #}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{# DjangoのデータをJavaScriptに渡す #}
{{ user_chart_labels|json_script:"user-chart-labels" }}
{{ user_chart_data|json_script:"user-chart-data" }}
{{ progress_chart_labels|json_script:"progress-chart-labels" }}
{{ progress_chart_data|json_script:"progress-chart-data" }}
{{ location_chart_labels|json_script:"location-chart-labels" }}
{{ location_chart_data|json_script:"location-chart-data" }}

<script>
document.addEventListener('DOMContentLoaded', () => {
  // --- グラフ1の描画 ---
  const userLabels = JSON.parse(document.getElementById('user-chart-labels').textContent);
  const userData = JSON.parse(document.getElementById('user-chart-data').textContent);
  const userCtx = document.getElementById('userReportChart').getContext('2d');
  new Chart(userCtx, {
    type: 'bar',
    data: {
      labels: userLabels,
      datasets: [{
        label: 'レポート件数',
        data: userData,
        backgroundColor: 'rgba(54, 162, 235, 0.5)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: { beginAtZero: true, ticks: { stepSize: 1 } }
      }
    }
  });

  // --- グラフ2の描画 ---
  const progressLabels = JSON.parse(document.getElementById('progress-chart-labels').textContent);
  const progressData = JSON.parse(document.getElementById('progress-chart-data').textContent);
  const progressCtx = document.getElementById('progressChart').getContext('2d');
  new Chart(progressCtx, {
    type: 'doughnut',
    data: {
      labels: progressLabels,
      datasets: [{
        label: '件数',
        data: progressData,
        backgroundColor: [
          'rgba(255, 99, 132, 0.5)',
          'rgba(54, 162, 235, 0.5)',
          'rgba(75, 192, 192, 0.5)',
          'rgba(255, 206, 86, 0.5)',
        ],
        borderColor: [
          'rgba(255, 99, 132, 1)',
          'rgba(54, 162, 235, 1)',
          'rgba(75, 192, 192, 1)',
          'rgba(255, 206, 86, 1)',
        ],
        borderWidth: 1
      }]
    }
  });

  // --- グラフ3の描画 ---
  const locationLabels = JSON.parse(document.getElementById('location-chart-labels').textContent);
  const locationData = JSON.parse(document.getElementById('location-chart-data').textContent);
  const hoursCtx = document.getElementById('hoursChart').getContext('2d');
  new Chart(hoursCtx, {
    type: 'bar',
    data: {
      labels: locationLabels,
      datasets: [{
        label: '合計作業時間 (時間)',
        data: locationData,
        backgroundColor: 'rgba(75, 192, 192, 0.5)',
        borderColor: 'rgba(75, 192, 192, 1)',
        borderWidth: 1
      }]
    },
    options: {
      indexAxis: 'y', // 横棒グラフにする
      scales: {
        x: { beginAtZero: true }
      }
    }
  });
});
</script>
{% endblock %}